<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>地震前 × 地震後 3DGS 比較（Supersplat埋め込み）</title>
<style>
  :root{ --alpha:1; --split:50%; --accent:#2b7cff; --radius:14px }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#0f1115;color:#e8e8e8;
    font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",Roboto,sans-serif}
  header{
    position:sticky; top:0; z-index:10; display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    padding:10px 12px; background:rgba(10,12,18,.85); backdrop-filter:blur(8px); border-bottom:1px solid #2a3142
  }
  h1{font-size:clamp(14px,2.4vw,18px); margin:0 8px 0 0}
  .btn{
    border:1px solid #2a3142; background:#1b2232; color:#e8e8e8;
    border-radius:999px; padding:8px 12px; cursor:pointer; font-size:14px
  }
  .btn.primary{outline:2px solid var(--accent)}
  .links{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
  .a-btn{
    display:inline-flex; align-items:center; gap:6px;
    border:1px solid #2a3142; background:#141a26; color:#e8e8e8; text-decoration:none;
    border-radius:999px; padding:8px 12px; font-size:14px
  }
  .wrap{ position:relative; height:calc(100dvh - 58px); min-height:320px; overflow:hidden }
  .stack{ position:absolute; inset:0 }
  iframe.viewer{
    position:absolute; inset:0; width:100%; height:100%; border:0;
    /* ← ここでタップ・ドラッグを禁止 */
    pointer-events:none;
  }
  /* 上レイヤー（地震後）: 既定はフェード */
  #now { opacity: var(--alpha); clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%) }
  /* スプリット用（予備） */
  .mode-split #now { clip-path: polygon(0 0, var(--split) 0, var(--split) 100%, 0 100%) }
  .badge{
    position:absolute; top:12px; left:12px; z-index:3;
    background:#1b2232; border:1px solid #2a3142; border-radius:8px; padding:6px 8px; font-size:12px
  }
  .badge.r{ left:auto; right:12px }
  .ctrl{
    position:absolute; left:0; right:0; bottom:12px; margin:auto; width:min(760px,94vw);
    display:flex; align-items:center; gap:10px;
    background:#1b2232; border:1px solid #2a3142; border-radius:var(--radius);
    padding:10px 12px; z-index:5; backdrop-filter:blur(6px)
  }
  .ctrl input[type="range"]{ flex:1; accent-color:var(--accent) }
  .label{ font-size:12px; opacity:.8 }
  .demoTip{
    position:absolute; inset:auto 0 90px 0; margin:auto; width:min(720px,92vw);
    display:flex; justify-content:center; pointer-events:none; z-index:6
  }
  .chip{
    padding:7px 10px; border-radius:999px; font-size:12px;
    background:rgba(20,26,38,.9); border:1px solid #2a3142;
    animation: tipfade 4s ease-in-out infinite
  }
  @keyframes tipfade{0%,100%{opacity:.2} 20%,80%{opacity:1}}
  @media (max-width:600px){
    .ctrl{ gap:8px; padding:10px }
    .btn, .a-btn{ padding:7px 10px; font-size:13px }
    .badge{ font-size:11px }
  }
</style>
</head>
<body>
  <header>
    <h1>地震前 × 地震後 3DGS 比較</h1>
    <button id="btnFade"  class="btn primary" aria-pressed="true"  title="フェード表示">フェード</button>
    <button id="btnSplit" class="btn"          aria-pressed="false" title="スライダー表示（予備機能）">スライダー</button>
    <button id="btnToggleTouch" class="btn" title="iframeの操作 有効/無効">操作を一時的に有効化</button>
    <div class="links">
      <a class="a-btn" href="https://superspl.at/s?id=f60f2a84" target="_blank" rel="noopener">地震前を開く</a>
      <a class="a-btn" href="https://superspl.at/s?id=7170d44a" target="_blank" rel="noopener">地震後を開く</a>
    </div>
  </header>

  <div id="wrap" class="wrap" role="application" aria-label="3D比較ビュー（タッチ操作は無効）">
    <div class="stack">
      <!-- あなたが示したURLを直差し込み済み（IDは固有に変更） -->
      <iframe id="past" class="viewer" allow="fullscreen; xr-spatial-tracking"
              src="https://superspl.at/s?id=f60f2a84"  title="地震前（過去）"></iframe>
      <iframe id="now"  class="viewer" allow="fullscreen; xr-spatial-tracking"
              src="https://superspl.at/s?id=7170d44a"  title="地震後（現在）"></iframe>
    </div>

    <div class="badge">地震前</div>
    <div class="badge r">地震後</div>

    <div class="ctrl">
      <span class="label" id="lblL">0%</span>
      <input id="range" type="range" min="0" max="100" step="1" value="50" aria-label="比較位置（フェード/スプリット）" />
      <span class="label" id="lblR">100%</span>
    </div>

    <div id="demoTip" class="demoTip" aria-hidden="true">
      <div class="chip">デモ中：自動で「地震前 ⇄ 地震後」をフェード表示しています</div>
    </div>
  </div>

<script>
(()=> {
  const root  = document.documentElement;
  const wrap  = document.getElementById('wrap');
  const iframePast = document.getElementById('past');
  const iframeNow  = document.getElementById('now');
  const range = document.getElementById('range');
  const btnFade  = document.getElementById('btnFade');
  const btnSplit = document.getElementById('btnSplit');
  const btnToggleTouch = document.getElementById('btnToggleTouch');
  const demoTip = document.getElementById('demoTip');

  // 既定＝フェード
  let isSplit = false;
  function applyModeUI(){
    document.body.classList.toggle('mode-split', isSplit);
    btnFade.classList.toggle('primary', !isSplit);
    btnSplit.classList.toggle('primary', isSplit);
    btnFade.setAttribute('aria-pressed', String(!isSplit));
    btnSplit.setAttribute('aria-pressed', String(isSplit));
  }
  function setFade(v){ root.style.setProperty('--alpha', (v/100).toFixed(3)) }
  function setSplit(v){ root.style.setProperty('--split', v + '%') }
  applyModeUI();
  setFade(range.value);

  range.addEventListener('input', e=>{
    const v = Number(e.target.value);
    if(isSplit) setSplit(v); else setFade(v);
  });
  btnFade.onclick = ()=>{ isSplit = false; applyModeUI(); setFade(range.value) };
  btnSplit.onclick= ()=>{ isSplit = true;  applyModeUI(); setSplit(range.value) };

  // タッチ/クリック禁止（既定）→ 一時的に有効化トグル
  let touchBlocked = true;
  function applyTouchBlock(){
    const val = touchBlocked ? 'none' : 'auto';
    iframePast.style.pointerEvents = val;
    iframeNow .style.pointerEvents = val;
    btnToggleTouch.textContent = touchBlocked ? '操作を一時的に有効化' : '操作を再び無効化';
    wrap.setAttribute('aria-label', touchBlocked ? '3D比較ビュー（タッチ操作は無効）' : '3D比較ビュー（タッチ操作は有効）');
  }
  btnToggleTouch.onclick = ()=>{ touchBlocked = !touchBlocked; applyTouchBlock() };
  applyTouchBlock();

  // 起動時デモ（フェードで2〜3往復）
  let demoRunning = true;
  const stopDemo = ()=>{ demoRunning = false; demoTip.style.display = 'none' };
  ['input','click'].forEach(ev=>{
    range.addEventListener(ev, stopDemo, {once:true});
    btnFade.addEventListener(ev, stopDemo, {once:true});
    btnSplit.addEventListener(ev, stopDemo, {once:true});
  });
  let t0 = null; const CYCLES = 3; const PERIOD = 3000;
  const easeInOutSine = x => -(Math.cos(Math.PI * x) - 1) / 2;
  function demoLoop(ts){
    if(!demoRunning) return;
    if(t0===null) t0 = ts;
    const elapsed = ts - t0;
    const progress = Math.min(1, (elapsed % PERIOD) / PERIOD);
    const cyc = Math.floor(elapsed / PERIOD);
    const p = easeInOutSine(progress);
    const val = progress < 0.5 ? (p*2*100) : ((2 - p*2)*100); // 0→100→0
    if(!isSplit){ setFade(val); range.value = Math.round(val) }
    if(cyc >= CYCLES){ stopDemo(); return }
    requestAnimationFrame(demoLoop);
  }
  requestAnimationFrame(demoLoop);
})();
</script>
</body>
</html>
